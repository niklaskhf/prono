<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>NewContactActivity.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">com.team16.sopra.sopra16team16.View</a> &gt; <span class="el_source">NewContactActivity.java</span></div><h1>NewContactActivity.java</h1><pre class="source lang-java linenums">package com.team16.sopra.sopra16team16.View;

import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.res.ColorStateList;
import android.graphics.Color;
import android.graphics.PorterDuff;
import android.os.Bundle;
import android.os.Handler;
import android.support.design.widget.FloatingActionButton;
import android.support.v4.content.ContextCompat;
import android.support.v7.app.AppCompatActivity;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.View;
import android.view.Window;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.RadioButton;
import android.widget.TextView;

import com.team16.sopra.sopra16team16.Controller.ContactManager;
import com.team16.sopra.sopra16team16.Controller.FileUtils;
import com.team16.sopra.sopra16team16.Controller.Player;
import com.team16.sopra.sopra16team16.Controller.Recorder;
import com.team16.sopra.sopra16team16.Controller.RecordingMode;
import com.team16.sopra.sopra16team16.R;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;


<span class="fc" id="L38">public class NewContactActivity extends AppCompatActivity {</span>

    private ContactManager contactManager;
    private Recorder recorder;

    private TextView lastNameTv;
    private EditText firstNameEdit;
    private EditText lastNameEdit;
    private EditText countryEdit;
    private EditText titleEdit;

    private ImageButton firstRecordButton;
    private ImageButton lastRecordButton;

    private RadioButton femaleRadioButton;
    private RadioButton maleRadioButton;
    private RadioButton unknownSexRadioButton;

    private FloatingActionButton confirmEditButton;
    private FloatingActionButton cancelButton;
    private FloatingActionButton recordButton;
    private ColorStateList fabBackground;

    private ImageView genderSign;


<span class="fc" id="L64">    private String firstName = &quot;&quot;;</span>
<span class="fc" id="L65">    private String lastName = &quot;&quot;;</span>
<span class="fc" id="L66">    private String title = &quot;&quot;;</span>
<span class="fc" id="L67">    private String country = &quot;&quot;;</span>
<span class="fc" id="L68">    private String gender = &quot;&quot;;</span>
    private int id;

<span class="fc" id="L71">    private String undoFirst = &quot;&quot;;</span>
<span class="fc" id="L72">    private String undoLast = &quot;&quot;;</span>
<span class="fc" id="L73">    private String undoTitle = &quot;&quot;;</span>
<span class="fc" id="L74">    private String undoCountry = &quot;&quot;;</span>
<span class="fc" id="L75">    private String undoGender = &quot;&quot;;</span>


    private String cause;

<span class="fc" id="L80">    private Player player = new Player();</span>


    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="fc" id="L85">        super.onCreate(savedInstanceState);</span>
<span class="fc" id="L86">        this.setContentView(R.layout.contact_editor);</span>
<span class="fc" id="L87">        setTitle(&quot;Editor&quot;);</span>

        //initialize();

<span class="fc" id="L91">        Bundle bundle = getIntent().getExtras();</span>

<span class="fc" id="L93">        firstName = (String) bundle.get(&quot;first&quot;);</span>
<span class="fc" id="L94">        undoFirst = bundle.getString(&quot;first&quot;);</span>
<span class="fc" id="L95">        lastName = (String) bundle.get(&quot;last&quot;);</span>
<span class="fc" id="L96">        undoLast = bundle.getString(&quot;last&quot;);</span>
<span class="fc" id="L97">        title = (String) bundle.get(&quot;title&quot;);</span>
<span class="fc" id="L98">        undoTitle = bundle.getString(&quot;title&quot;);</span>
<span class="fc" id="L99">        country = (String) bundle.get(&quot;country&quot;);</span>
<span class="fc" id="L100">        undoCountry = bundle.getString(&quot;country&quot;);</span>
<span class="fc" id="L101">        gender = (String) bundle.get(&quot;gender&quot;);</span>
<span class="fc" id="L102">        undoGender = bundle.getString(&quot;gender&quot;);</span>
<span class="fc" id="L103">        id = (Integer) bundle.get(&quot;id&quot;);</span>
<span class="fc" id="L104">        cause = bundle.get(&quot;cause&quot;).toString();</span>


<span class="fc" id="L107">        Log.d(&quot;first&quot;, firstName);</span>

<span class="fc" id="L109">        initialize();</span>

<span class="fc" id="L111">        recorder = new Recorder(this, recordButton, firstRecordButton, lastRecordButton);</span>
<span class="fc" id="L112">    }</span>

    @Override
    public void onBackPressed() {
<span class="fc" id="L116">        super.onBackPressed();</span>
<span class="fc" id="L117">        FileUtils.deleteTempFiles();</span>
<span class="fc" id="L118">        finish();</span>
<span class="fc" id="L119">    }</span>

    /**
     * Initializes the views etc.
     */
    public void initialize() {

<span class="fc" id="L126">        findViewByTextView();</span>
<span class="fc" id="L127">        findViewByIdEditButton();</span>


<span class="fc" id="L130">        findViewByIdRadioButton();</span>

<span class="fc" id="L132">        findViewByIdImageView();</span>

<span class="fc" id="L134">        setText();</span>

<span class="fc" id="L136">        setButtons();</span>
<span class="fc" id="L137">    }</span>

    /**
     * Sets the editText data
     */
    public void setText() {
<span class="fc" id="L143">        firstNameEdit.setText(firstName);</span>
<span class="fc" id="L144">        lastNameEdit.setText(lastName);</span>
<span class="fc" id="L145">        titleEdit.setText(title);</span>
<span class="fc" id="L146">        countryEdit.setText(country);</span>
<span class="fc bfc" id="L147" title="All 2 branches covered.">        if (gender.equals(&quot;FEMALE&quot;)) {</span>
<span class="fc" id="L148">            femaleRadioButton.setChecked(true);</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">        } else if (gender.equals(&quot;MALE&quot;)) {</span>
<span class="fc" id="L150">            maleRadioButton.setChecked(true);</span>
<span class="fc bfc" id="L151" title="All 2 branches covered.">        } else if (gender.equals(&quot;UNKNOWN&quot;)) {</span>
<span class="fc" id="L152">            unknownSexRadioButton.setChecked(true);</span>
        }
<span class="fc" id="L154">    }</span>

    /**
     * Sets the buttons
     */
    public void setButtons() {
        // add Button to change layout to contact viewer
<span class="fc" id="L161">        confirmEditButton = (FloatingActionButton) findViewById(R.id.confirm_button);</span>
<span class="fc" id="L162">        confirmEditButton.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View view) {

                // get the gender data
<span class="fc bfc" id="L167" title="All 2 branches covered.">                if (femaleRadioButton.isChecked()) {</span>
<span class="fc" id="L168">                    gender = &quot;FEMALE&quot;;</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">                } else if (maleRadioButton.isChecked()) {</span>
<span class="fc" id="L170">                    gender = &quot;MALE&quot;;</span>
<span class="fc bfc" id="L171" title="All 2 branches covered.">                } else if (unknownSexRadioButton.isChecked()) {</span>
<span class="fc" id="L172">                    gender = &quot;UNKNOWN&quot;;</span>
                }

                // check if necesarry requirements are met
                // required: LAST and RECORDING

<span class="fc bfc" id="L178" title="All 2 branches covered.">                if (requireGenericCountryDialog()) {</span>
<span class="fc" id="L179">                    genericCountryChangedDialog();</span>
<span class="fc bfc" id="L180" title="All 2 branches covered.">                } else if(!confirmRequirements()) {</span>
<span class="fc" id="L181">                    confirmRequirementsDialog();</span>
                } else {
                    // pass data back to ContactViewerActivity
<span class="fc" id="L184">                    Intent intent = new Intent(NewContactActivity.this, ContactViewerActivity.class);</span>
<span class="fc" id="L185">                    Bundle bundle = new Bundle();</span>
<span class="fc" id="L186">                    bundle.putString(&quot;first&quot;, capitalize(getFirstString()));</span>
<span class="fc" id="L187">                    bundle.putString(&quot;last&quot;, capitalize(getLastString()));</span>
<span class="fc" id="L188">                    bundle.putString(&quot;title&quot;, capitalize(getTitleString()));</span>
<span class="fc" id="L189">                    bundle.putString(&quot;country&quot;, capitalize(getCountryString()));</span>
<span class="fc" id="L190">                    bundle.putInt(&quot;id&quot;, id);</span>
<span class="fc" id="L191">                    bundle.putString(&quot;gender&quot;, gender);</span>


<span class="fc bfc" id="L194" title="All 2 branches covered.">                    if (cause.equals(&quot;CREATE&quot;)) {</span>
<span class="fc" id="L195">                        intent.putExtras(bundle);</span>
                        // create the new contact
<span class="fc" id="L197">                        setContact();</span>
<span class="fc" id="L198">                        FileUtils.confirmAudio(id);</span>
<span class="fc" id="L199">                        FileUtils.confirmAudio(getFirstString().toLowerCase() + getCountryString().toLowerCase());</span>
<span class="fc" id="L200">                        FileUtils.confirmAudio(getLastString().toLowerCase() + getCountryString().toLowerCase());</span>
<span class="fc" id="L201">                        FileUtils.deleteTempFiles();</span>
<span class="fc" id="L202">                        startActivity(intent);</span>
<span class="fc" id="L203">                        finish();</span>
                    } else {
                        // add previous data to allow undo
<span class="fc" id="L206">                        bundle.putString(&quot;action&quot;, &quot;undo&quot;);</span>
<span class="fc" id="L207">                        bundle.putString(&quot;undoFirst&quot;, undoFirst);</span>
<span class="fc" id="L208">                        bundle.putString(&quot;undoLast&quot;, undoLast);</span>
<span class="fc" id="L209">                        bundle.putString(&quot;undoTitle&quot;, undoTitle);</span>
<span class="fc" id="L210">                        bundle.putString(&quot;undoCountry&quot;, undoCountry);</span>
<span class="fc" id="L211">                        bundle.putString(&quot;undoGender&quot;, undoGender);</span>
<span class="fc" id="L212">                        setResult(RESULT_OK, new Intent().putExtras(bundle));</span>

                        // ALERT DIALOG
<span class="fc" id="L215">                        FileUtils.confirmAudio(id);</span>
<span class="fc" id="L216">                        FileUtils.confirmAudio(getFirstString().toLowerCase() + getCountryString().toLowerCase());</span>
<span class="fc" id="L217">                        FileUtils.confirmAudio(getLastString().toLowerCase() + getCountryString().toLowerCase());</span>
<span class="fc" id="L218">                        FileUtils.deleteTempFiles();</span>
                        // update contact in database
<span class="fc" id="L220">                        updateContact();</span>
<span class="fc" id="L221">                        finish();</span>
                    }
                }

<span class="fc" id="L225">            }</span>
        });

        // add Button to cancel the current (adding of new contact)/(editing of existing button)
<span class="fc" id="L229">        cancelButton = (FloatingActionButton) findViewById(R.id.cancel_button);</span>
<span class="fc" id="L230">        cancelButton.setOnClickListener(new View.OnClickListener() {</span>

            @Override
            public void onClick(View view) {
<span class="fc" id="L234">                onBackPressed();</span>
<span class="fc" id="L235">            }</span>
        });

        // add Button to record a name
<span class="fc" id="L239">        recordButton = (FloatingActionButton) findViewById(R.id.record_button);</span>
<span class="fc" id="L240">        recordButton.setOnClickListener(new View.OnClickListener() {</span>

            @Override
            public void onClick(View view) {
<span class="fc bfc" id="L244" title="All 2 branches covered.">                if (recorder.isPressed()) {</span>
<span class="fc" id="L245">                    recorder.stopRecording();</span>
<span class="fc" id="L246">                    enableButtons();</span>
                } else {
<span class="fc" id="L248">                    disableButtons(recordButton);</span>
<span class="fc" id="L249">                    recorder.startRecording(id, RecordingMode.RECORDING_CUSTOM);</span>
                }
<span class="fc" id="L251">            }</span>
        });

<span class="fc" id="L254">        fabBackground = recordButton.getBackgroundTintList();</span>


        // set the first name record button
<span class="fc" id="L258">        firstRecordButton = (ImageButton) findViewById(R.id.recordFirstButton);</span>

<span class="fc" id="L260">        firstRecordButton.setOnClickListener(new View.OnClickListener() {</span>

            @Override
            public void onClick(View view) {
<span class="fc bfc" id="L264" title="All 2 branches covered.">                if (getFirstString().equals(&quot;&quot;)) {</span>
<span class="fc" id="L265">                    showEditAlertDialog();</span>
                } else {
<span class="fc bfc" id="L267" title="All 2 branches covered.">                    if (recorder.isPressed()) {</span>
<span class="fc" id="L268">                        recorder.stopRecording();</span>
<span class="fc" id="L269">                        enableButtons();</span>
                    } else {
<span class="fc" id="L271">                        recorder.triggerRecordingGeneric(getFirstString(), getCountryString(), RecordingMode.RECORDING_FIRST);</span>
<span class="fc" id="L272">                        disableButtons(firstRecordButton);</span>
                    }
                }
<span class="fc" id="L275">            }</span>
        });



        // set the lastName record button
<span class="fc" id="L281">        lastRecordButton = (ImageButton) findViewById(R.id.recordLastButton);</span>

<span class="fc" id="L283">        lastRecordButton.setOnClickListener(new View.OnClickListener() {</span>

            @Override
            public void onClick(View view) {
<span class="fc bfc" id="L287" title="All 2 branches covered.">                if (getLastString().equals(&quot;&quot;)) {</span>
<span class="fc" id="L288">                    showEditAlertDialog();</span>
                } else {
<span class="fc bfc" id="L290" title="All 2 branches covered.">                    if (recorder.isPressed()) {</span>
<span class="fc" id="L291">                        recorder.stopRecording();</span>
<span class="fc" id="L292">                        enableButtons();</span>
                    } else {
<span class="fc" id="L294">                        recorder.triggerRecordingGeneric(getLastString(), getCountryString(), RecordingMode.RECORDING_LAST);</span>
<span class="fc" id="L295">                        disableButtons(lastRecordButton);</span>
                    }
                }
<span class="fc" id="L298">            }</span>
        });

<span class="fc" id="L301">    }</span>

    /**
     * Saves a contact
     */
    public void setContact() {
<span class="fc" id="L307">        contactManager = ContactManager.getInstance(this.getApplicationContext());</span>
<span class="fc" id="L308">        Log.d(&quot;genderCreate&quot;, gender);</span>
<span class="fc" id="L309">        contactManager.createContact(</span>
<span class="fc" id="L310">                capitalize(getFirstString()),</span>
<span class="fc" id="L311">                capitalize(getLastString()),</span>
<span class="fc" id="L312">                capitalize(getTitleString()),</span>
<span class="fc" id="L313">                capitalize(getCountryString()),</span>
                gender);
<span class="fc" id="L315">        Log.i(&quot;createContact&quot;, &quot;created contact &quot; + firstNameEdit.getText().toString());</span>
<span class="fc" id="L316">    }</span>

    /**
     * Updates an existing contact
     */
    public void updateContact() {
<span class="fc" id="L322">        contactManager = ContactManager.getInstance(this.getApplicationContext());</span>
<span class="fc" id="L323">        contactManager.updateContact(id,</span>
<span class="fc" id="L324">                capitalize(getFirstString()),</span>
<span class="fc" id="L325">                capitalize(getLastString()),</span>
<span class="fc" id="L326">                capitalize(getTitleString()),</span>
<span class="fc" id="L327">                capitalize(getCountryString()),</span>
                gender);

<span class="fc" id="L330">    }</span>

    /**
     * Sets the TextViews
     */
    private void findViewByTextView() {
<span class="fc" id="L336">        lastNameTv = (TextView) findViewById(R.id.last_text);</span>
<span class="fc" id="L337">    }</span>
    private void findViewByIdImageView() {
<span class="fc" id="L339">        genderSign = (ImageView) findViewById(R.id.gender_sign);</span>
<span class="fc" id="L340">    }</span>

    /**
     * Sets the radio buttons
     */
    private void findViewByIdRadioButton() {
<span class="fc" id="L346">        femaleRadioButton = (RadioButton) findViewById(R.id.female_radioButton);</span>
<span class="fc" id="L347">        maleRadioButton = (RadioButton) findViewById(R.id.male_radioButton);</span>
<span class="fc" id="L348">        unknownSexRadioButton = (RadioButton) findViewById(R.id.unkown_radioButton);</span>
<span class="fc" id="L349">    }</span>

    /**
     * Sets the EditTexts
     */
    private void findViewByIdEditButton() {
<span class="fc" id="L355">        firstNameEdit = (EditText) findViewById(R.id.first_edit);</span>
<span class="fc" id="L356">        lastNameEdit = (EditText) findViewById(R.id.last_edit);</span>
<span class="fc" id="L357">        countryEdit = (EditText) findViewById(R.id.country_edit);</span>
<span class="fc" id="L358">        titleEdit = (EditText) findViewById(R.id.title_edit);</span>

<span class="fc" id="L360">        final ColorStateList originalTextColor = lastNameTv.getTextColors();</span>

        // create listener to check for data
        // if EditText is not empty, reset color to default.
<span class="fc" id="L364">        TextWatcher tw = new TextWatcher() {</span>
            public void afterTextChanged(Editable s){
<span class="fc bfc" id="L366" title="All 2 branches covered.">                if (!(getLastString().equals(&quot;&quot;))) {</span>
<span class="fc" id="L367">                    lastNameEdit.getBackground().clearColorFilter();</span>
<span class="fc" id="L368">                    lastNameTv.setTextColor(originalTextColor);</span>
                }
<span class="fc" id="L370">            }</span>
            public void  beforeTextChanged(CharSequence s, int start, int count, int after){
                // you can check for enter key here
<span class="fc" id="L373">            }</span>
            public void  onTextChanged (CharSequence s, int start, int before,int count) {
<span class="fc" id="L375">            }</span>
        };
        // add the listener
<span class="fc" id="L378">        lastNameEdit.addTextChangedListener(tw);</span>
<span class="fc" id="L379">    }</span>


    /**
     * Checks if the necessary requirements are met.
     * Those are:
     * - last name cant be empty
     * - there has to be a recording associated to the data
     *
     * @return boolean value
     *          true - requiremente met
     *          false - requirements not met
     */
    public boolean confirmRequirements() {
        // TODO bring arraylist back here
<span class="fc" id="L394">        int i = 0;</span>
        // check if lastName is empty
<span class="fc bfc" id="L396" title="All 2 branches covered.">        if (getLastString().equals(&quot;&quot;)) {</span>
<span class="fc" id="L397">            lastNameTv.setTextColor(ContextCompat.getColor(this, R.color.colorAccent));</span>
<span class="fc" id="L398">            lastNameEdit.getBackground().setColorFilter(Color.RED, PorterDuff.Mode.SRC_IN);</span>
<span class="fc" id="L399">            i++;</span>
        }
        // check if there is a recording for the lastName, or if there is a custom recording
<span class="fc bfc" id="L402" title="All 4 branches covered.">        if (!lastRecordExists() &amp;&amp; !customRecordExists()) {</span>
<span class="fc" id="L403">            lastRecordButton.setImageTintList(ColorStateList.valueOf(Color.RED));</span>
<span class="fc" id="L404">            recordButton.setBackgroundTintList(ColorStateList.valueOf(Color.RED));</span>
<span class="fc" id="L405">            i++;</span>
        }
        // check if there is a first name
<span class="fc bfc" id="L408" title="All 2 branches covered.">        if (!getFirstString().equals(&quot;&quot;)) {</span>
            // if there is a first name:
            // check for a recording of the firstName, or alternatively a custom recording
<span class="fc bfc" id="L411" title="All 4 branches covered.">            if (!firstRecordExists() &amp;&amp; !customRecordExists()) {</span>
<span class="fc" id="L412">                firstRecordButton.setImageTintList(ColorStateList.valueOf(Color.RED));</span>
<span class="fc" id="L413">                recordButton.setBackgroundTintList(ColorStateList.valueOf(Color.RED));</span>
<span class="fc" id="L414">                i++;</span>
            }
        }

        // return any found issues
<span class="fc bfc" id="L419" title="All 2 branches covered.">        return i == 0;</span>
    }


    /**
     * Check if the country has changed
     * @return
     */
    public boolean requireGenericCountryDialog() {
<span class="fc bfc" id="L428" title="All 2 branches covered.">        if (!getCountryString().equals(undoCountry)) {</span>
            // check if new requirements are already met with existing recordings
<span class="fc bfc" id="L430" title="All 2 branches covered.">            if (!confirmRequirements()) {</span>
<span class="fc" id="L431">                return true;</span>
            }
        }

<span class="fc" id="L435">        return false;</span>
    }

    /**
     * Checks if any temporary of permanent audio files associated to the last name exist
     * @return true - a file exists
     *         false - no file exists
     */
    public boolean lastRecordExists() {
<span class="fc" id="L444">        String lastRecordString = FileUtils.PATH + getLastString().toLowerCase() + getCountryString().toLowerCase();</span>
<span class="fc bfc" id="L445" title="All 2 branches covered.">        if (new File(lastRecordString + &quot;.3gp&quot;).exists() ||</span>
<span class="fc bfc" id="L446" title="All 2 branches covered.">                new File(lastRecordString + &quot;temp.3gp&quot;).exists()) {</span>
<span class="fc" id="L447">            return true;</span>
        }
<span class="fc" id="L449">        return false;</span>
    }

    /**
     * Checks if any temporary of permanent audio files associated to the first name exist
     * @return true - a file exists
     *         false - no file exists
     */
    public boolean firstRecordExists() {
<span class="fc" id="L458">        String firstRecordString = FileUtils.PATH + getFirstString().toLowerCase() + getCountryString().toLowerCase();</span>
<span class="fc bfc" id="L459" title="All 2 branches covered.">        if (new File(firstRecordString + &quot;.3gp&quot;).exists() ||</span>
<span class="fc bfc" id="L460" title="All 2 branches covered.">                new File(firstRecordString + &quot;temp.3gp&quot;).exists()) {</span>
<span class="fc" id="L461">            return true;</span>
        }
<span class="fc" id="L463">        return false;</span>
    }

    /**
     * Checks if any temporary of permanent audio files associated to the id exist
     * @return true - a file exists
     *         false - no file exists
     */
    public boolean customRecordExists() {

<span class="fc bfc" id="L473" title="All 2 branches covered.">        if (new File(FileUtils.PATH + id + &quot;.3gp&quot;).exists() ||</span>
<span class="fc bfc" id="L474" title="All 2 branches covered.">                new File(FileUtils.PATH + id + &quot;temp.3gp&quot;).exists()) {</span>
<span class="fc" id="L475">            return true;</span>
        }
<span class="fc" id="L477">        return false;</span>
    }


    /**
     * A dialog informing the user about missing requirements
     */
    public void confirmRequirementsDialog() {
<span class="fc" id="L485">        AlertDialog.Builder alertDialog = new AlertDialog.Builder(this);</span>

<span class="fc" id="L487">        alertDialog.setMessage(&quot;The last name and either generic recordings of the first/last name, &quot; +</span>
                &quot;or a custom recording of the pronunciation are required.\n\n&quot; +
                &quot;Please enter the name/record a pronunciation.&quot;);
<span class="fc" id="L490">        alertDialog.setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialogInterface, int i) {
                // do nothing
<span class="fc" id="L494">            }</span>
        });
<span class="fc" id="L496">        alertDialog.show();</span>
<span class="fc" id="L497">    }</span>



    /**
     * Returns the content of firstNameEdit without spaces in the beginning or end
     * @return firstNameEdit contents
     */
    public String getFirstString() {
<span class="fc" id="L506">        String value = firstNameEdit.getText().toString();</span>
<span class="fc bfc" id="L507" title="All 2 branches covered.">        if (value.length() == 0) {</span>
<span class="fc" id="L508">            return &quot;&quot;;</span>
        }
<span class="pc bpc" id="L510" title="1 of 4 branches missed.">        while (value.length() != 0 &amp;&amp; value.charAt(0) == ' ') {</span>
<span class="fc" id="L511">            value = value.substring(1);</span>
        }

<span class="pc bpc" id="L514" title="2 of 4 branches missed.">        while (value.length() != 0 &amp;&amp; value.charAt(value.length() - 1) == ' ') {</span>
<span class="nc" id="L515">            value = value.substring(0, value.length() - 1);</span>
        }

<span class="fc bfc" id="L518" title="All 2 branches covered.">        for (int i = 0; i &lt; value.length(); i++) {</span>
<span class="fc bfc" id="L519" title="All 2 branches covered.">            if (!Character.isAlphabetic(value.charAt(i))) {</span>
<span class="fc" id="L520">                value = value.replace(String.valueOf(value.charAt(i)), &quot;&quot;);</span>
            }
        }

<span class="fc" id="L524">        return value;</span>
    }

    /**
     * Returns the content of lastNameEdit without spaces in the beginning or end
     * @return lastNameEdit contents
     */
    public String getLastString() {
<span class="fc" id="L532">        String value = lastNameEdit.getText().toString();</span>

<span class="fc bfc" id="L534" title="All 2 branches covered.">        if (value.length() == 0) {</span>
<span class="fc" id="L535">            return &quot;&quot;;</span>
        }
<span class="fc bfc" id="L537" title="All 4 branches covered.">        while (value.length() != 0 &amp;&amp; value.charAt(0) == ' ') {</span>
<span class="fc" id="L538">            value = value.substring(1);</span>
        }


<span class="pc bpc" id="L542" title="1 of 4 branches missed.">        while (value.length() != 0 &amp;&amp; value.charAt(value.length()-1) == ' ') {</span>
<span class="nc" id="L543">            value = value.substring(0, value.length() - 1);</span>
        }

<span class="fc bfc" id="L546" title="All 2 branches covered.">        for (int i = 0; i &lt; value.length(); i++) {</span>
<span class="fc bfc" id="L547" title="All 2 branches covered.">            if (!Character.isAlphabetic(value.charAt(i))) {</span>
<span class="fc" id="L548">                value = value.replace(String.valueOf(value.charAt(i)), &quot;&quot;);</span>
            }
        }

<span class="fc" id="L552">        return value;</span>
    }

    /**
     * Returns the content of titleEdit without spaces in the beginning or end
     * @return titleEdit contents
     */
    public String getTitleString() {
<span class="fc" id="L560">        String value = titleEdit.getText().toString();</span>

<span class="fc bfc" id="L562" title="All 2 branches covered.">        if (value.length() == 0) {</span>
<span class="fc" id="L563">            return &quot;&quot;;</span>
        }
<span class="pc bpc" id="L565" title="1 of 4 branches missed.">        while (value.length() != 0 &amp;&amp; value.charAt(0) == ' ') {</span>
<span class="fc" id="L566">            value = value.substring(1);</span>
        }


<span class="pc bpc" id="L570" title="1 of 4 branches missed.">        while (value.length() != 0 &amp;&amp; value.charAt(value.length() - 1) == ' ') {</span>
<span class="fc" id="L571">            value = value.substring(0, value.length() - 1);</span>
        }

<span class="fc bfc" id="L574" title="All 2 branches covered.">        for (int i = 0; i &lt; value.length(); i++) {</span>
<span class="pc bpc" id="L575" title="1 of 2 branches missed.">            if (!Character.isAlphabetic(value.charAt(i))) {</span>
<span class="nc" id="L576">                value = value.replace(String.valueOf(value.charAt(i)), &quot;&quot;);</span>
            }
        }

<span class="fc" id="L580">        return value;</span>
    }

    /**
     * Returns the content of countryEdit without spaces in the beginning or end
     * @return countryEdit contents
     */
    public String getCountryString() {
<span class="fc" id="L588">        String value = countryEdit.getText().toString();</span>

<span class="fc bfc" id="L590" title="All 2 branches covered.">        if ( value.length() == 0) {</span>
<span class="fc" id="L591">            return &quot;&quot;;</span>
        }
<span class="pc bpc" id="L593" title="1 of 4 branches missed.">        while (value.length() != 0 &amp;&amp;value.charAt(0) == ' ') {</span>
<span class="fc" id="L594">            value = value.substring(1);</span>
        }


<span class="pc bpc" id="L598" title="1 of 4 branches missed.">        while (value.length() != 0 &amp;&amp; value.charAt(value.length() - 1) == ' ') {</span>
<span class="fc" id="L599">            value = value.substring(0, value.length() - 1);</span>
        }

<span class="fc bfc" id="L602" title="All 2 branches covered.">        for (int i = 0; i &lt; value.length(); i++) {</span>
<span class="fc bfc" id="L603" title="All 2 branches covered.">            if (!Character.isAlphabetic(value.charAt(i))) {</span>
<span class="fc" id="L604">                value = value.replace(String.valueOf(value.charAt(i)), &quot;&quot;);</span>
            }
        }

<span class="fc" id="L608">        return value;</span>
    }

    /**
     * Capitalizes a String - First letter capitalized, everything else non capitalized
     */
    public String capitalize(String string) {
<span class="fc bfc" id="L615" title="All 2 branches covered.">        if (string.equals(&quot;&quot;)) {</span>
<span class="fc" id="L616">            return &quot;&quot;;</span>
        }
<span class="fc" id="L618">        string.toLowerCase();</span>
<span class="fc" id="L619">        string = string.substring(0,1).toUpperCase() + string.substring(1, string.length());</span>
<span class="fc" id="L620">        return string;</span>
    }


    /**
     * Diables all buttons, used when recording
     * @param active the active recording button, will remain active
     */
    public void disableButtons(final FloatingActionButton active) {
<span class="fc" id="L629">        firstRecordButton.setEnabled(false);</span>
<span class="fc" id="L630">        lastRecordButton.setEnabled(false);</span>
<span class="fc" id="L631">        cancelButton.setEnabled(false);</span>
<span class="fc" id="L632">        confirmEditButton.setEnabled(false);</span>
<span class="fc" id="L633">        recordButton.setEnabled(false);</span>

<span class="fc" id="L635">        Runnable activateActive = new Runnable() {</span>
            @Override
            public void run() {
<span class="fc" id="L638">                active.setEnabled(true);</span>
<span class="fc" id="L639">            }</span>
        };

<span class="fc" id="L642">        Handler handler = new Handler();</span>
<span class="fc" id="L643">        handler.postDelayed(activateActive, 500);</span>
<span class="fc" id="L644">    }</span>

    /**
     * Diables all buttons, used when recording
     * @param active the active recording button, will remain active
     */
    public void disableButtons(ImageButton active) {
<span class="fc" id="L651">        firstRecordButton.setEnabled(false);</span>
<span class="fc" id="L652">        lastRecordButton.setEnabled(false);</span>
<span class="fc" id="L653">        cancelButton.setEnabled(false);</span>
<span class="fc" id="L654">        confirmEditButton.setEnabled(false);</span>
<span class="fc" id="L655">        recordButton.setEnabled(false);</span>

<span class="fc" id="L657">        active.setEnabled(true);</span>
<span class="fc" id="L658">    }</span>

    /**
     * Enables all buttons
     */
    public void enableButtons() {
<span class="fc" id="L664">        firstRecordButton.setEnabled(true);</span>
<span class="fc" id="L665">        lastRecordButton.setEnabled(true);</span>
<span class="fc" id="L666">        cancelButton.setEnabled(true);</span>
<span class="fc" id="L667">        confirmEditButton.setEnabled(true);</span>
<span class="fc" id="L668">        recordButton.setEnabled(true);</span>
<span class="fc" id="L669">    }</span>


    /**
     * AlertDialog asking the user for confirmation to copy pronounciations to the new country.
     * Only asks, if there are no existing files.
     */
    public void genericCountryChangedDialog() {
        // get the dialog
<span class="fc" id="L678">        final AlertDialog alertDialog = new AlertDialog.Builder(this).create();</span>
<span class="fc" id="L679">        alertDialog.setCanceledOnTouchOutside(false);</span>
<span class="fc" id="L680">        alertDialog.show();</span>

        // set the custom layout
<span class="fc" id="L683">        Window win = alertDialog.getWindow();</span>
<span class="pc bpc" id="L684" title="1 of 2 branches missed.">        if (win != null) {</span>
<span class="fc" id="L685">            win.setContentView(R.layout.confirm_generic_country_dialog);</span>

            // text
<span class="fc" id="L688">            TextView textDialog = (TextView) win.findViewById(R.id.text_dialog);</span>
<span class="fc" id="L689">            textDialog.setText(&quot;Do you want to keep the generic name &quot; +</span>
<span class="fc" id="L690">                    &quot;pronunciation in relation to the country &quot; + getCountryString());</span>

            // cancel
<span class="fc" id="L693">            ImageButton cancelDialog = (ImageButton) win.findViewById(R.id.cancel_dialog);</span>

            // NO
<span class="fc" id="L696">            cancelDialog.setOnClickListener(new View.OnClickListener() {</span>
                @Override
                public void onClick(View view) {
<span class="fc" id="L699">                    alertDialog.dismiss();</span>
<span class="pc bpc" id="L700" title="1 of 2 branches missed.">                    if(!confirmRequirements()) {</span>
<span class="fc" id="L701">                        confirmRequirementsDialog();</span>
                    }
<span class="fc" id="L703">                }</span>
            });



            // confirm
<span class="fc" id="L709">            ImageButton acceptDialog = (ImageButton) win.findViewById(R.id.accept_dialog);</span>

            // YES
<span class="fc" id="L712">            acceptDialog.setOnClickListener(new View.OnClickListener() {</span>
                @Override
                public void onClick(View view) {
                    // copy generic files
<span class="pc bpc" id="L716" title="1 of 2 branches missed.">                    if (!firstRecordExists()) {</span>
                        try {
                            // copy temp
<span class="pc bpc" id="L719" title="1 of 2 branches missed.">                            if (new File(FileUtils.PATH + getFirstString().toLowerCase() + undoCountry.toLowerCase() + &quot;temp.3gp&quot;).exists()) {</span>
<span class="fc" id="L720">                                FileUtils.copyFile(new FileInputStream(new File(FileUtils.PATH + getFirstString().toLowerCase() + undoCountry.toLowerCase() + &quot;temp.3gp&quot;)),</span>
<span class="fc" id="L721">                                        new FileOutputStream(new File(FileUtils.PATH + getFirstString().toLowerCase() + getCountryString().toLowerCase() + &quot;temp.3gp&quot;)));</span>
                            } else {
                                // copy perm
<span class="nc" id="L724">                                FileUtils.copyFile(new FileInputStream(new File(FileUtils.PATH + getFirstString().toLowerCase() + undoCountry.toLowerCase() + &quot;.3gp&quot;)),</span>
<span class="nc" id="L725">                                        new FileOutputStream(new File(FileUtils.PATH + getFirstString().toLowerCase() + getCountryString().toLowerCase() + &quot;.3gp&quot;)));</span>
                            }
<span class="fc" id="L727">                            firstRecordColor();</span>
<span class="nc" id="L728">                        } catch (IOException e) {</span>
                            // handle the exception
<span class="nc" id="L730">                            Log.d(&quot;CopyIOException&quot;, e.getMessage());</span>
<span class="fc" id="L731">                        }</span>
                    }

<span class="pc bpc" id="L734" title="1 of 2 branches missed.">                    if (!lastRecordExists()) {</span>
                        try {
                            // copy temp
<span class="nc bnc" id="L737" title="All 2 branches missed.">                            if (new File(FileUtils.PATH + getLastString().toLowerCase() + undoCountry.toLowerCase() + &quot;temp.3gp&quot;).exists()) {</span>
<span class="nc" id="L738">                                FileUtils.copyFile(new FileInputStream(new File(FileUtils.PATH + getLastString().toLowerCase() + undoCountry.toLowerCase() + &quot;temp.3gp&quot;)),</span>
<span class="nc" id="L739">                                        new FileOutputStream(new File(FileUtils.PATH + getLastString().toLowerCase() + getCountryString().toLowerCase() + &quot;temp.3gp&quot;)));</span>
                            } else {
                                // copy perm
<span class="nc" id="L742">                                FileUtils.copyFile(new FileInputStream(new File(FileUtils.PATH + getLastString().toLowerCase() + undoCountry.toLowerCase() + &quot;.3gp&quot;)),</span>
<span class="nc" id="L743">                                        new FileOutputStream(new File(FileUtils.PATH + getLastString().toLowerCase() + getCountryString().toLowerCase() + &quot;.3gp&quot;)));</span>
                            }
<span class="nc" id="L745">                            lastRecordColor();</span>
<span class="nc" id="L746">                        } catch (IOException e) {</span>
                            // handle the exception
<span class="nc" id="L748">                            Log.d(&quot;CopyIOException&quot;, e.getMessage());</span>
<span class="nc" id="L749">                        }</span>
                    }
<span class="fc" id="L751">                    alertDialog.dismiss();</span>
                    // check if all requirements are met now
<span class="pc bpc" id="L753" title="1 of 2 branches missed.">                    if(!confirmRequirements()) {</span>
<span class="nc" id="L754">                        confirmRequirementsDialog();</span>
                    }
<span class="fc" id="L756">                }</span>
            });
        }
<span class="fc" id="L759">    }</span>


    /**
     * resets the firstRecordButton
     */
    public void firstRecordColor() {
<span class="fc" id="L766">        firstRecordButton.setImageTintList(ColorStateList.valueOf(Color.BLACK));</span>
<span class="pc bpc" id="L767" title="1 of 2 branches missed.">        if (lastRecordButton.getBackground() == null) {</span>
<span class="fc" id="L768">            recordButton.setBackgroundTintList(fabBackground);</span>
        }
<span class="fc" id="L770">    }</span>

    /**
     * resets the lastRecordButton color
     */
    public void lastRecordColor() {
<span class="fc" id="L776">        lastRecordButton.setImageTintList(ColorStateList.valueOf(Color.BLACK));</span>
<span class="pc bpc" id="L777" title="1 of 2 branches missed.">        if (firstRecordButton.getBackground() == null) {</span>
<span class="fc" id="L778">            recordButton.setBackgroundTintList(fabBackground);</span>
        }
<span class="fc" id="L780">    }</span>

    /**
     * resets the recordButton color
     */
    public void customRecordColor() {
<span class="fc" id="L786">        recordButton.setBackgroundTintList(fabBackground);</span>
<span class="fc" id="L787">        firstRecordColor();</span>
<span class="fc" id="L788">        lastRecordColor();</span>
<span class="fc" id="L789">    }</span>


    /**
     * Alert dialog informing the user about the empty editText.
     */
    public void showEditAlertDialog() {
<span class="fc" id="L796">        AlertDialog.Builder alertDialog = new AlertDialog.Builder(this);</span>

<span class="fc" id="L798">        alertDialog.setMessage(&quot;You can't record for an empty name.&quot;);</span>
<span class="fc" id="L799">        alertDialog.setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialogInterface, int i) {
                // do nothing
<span class="fc" id="L803">            }</span>
        });
<span class="fc" id="L805">        alertDialog.show();</span>
<span class="fc" id="L806">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.2.3</div></body></html>